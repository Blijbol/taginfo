const tabsConfig = {
    keys: function(query) {
        return new DynamicTable('grid-keys', {
            url: '/api/4/keys/all',
            params: { query: query },
            colModel: [
                { display: h(texts.misc.count), name: 'count_all', width: 80, sortable: true, align: 'right' },
                { display: h(texts.osm.key), name: 'key', width: 500, sortable: true }
            ],
            sortname: 'count_all',
            sortorder: 'desc',
            processRow: row => {
                return [
                    fmt_with_ts(row.count_all),
                    link_to_key_with_highlight(row.key, query)
                ];
            }
        });
    },
    values: function(query) {
        return new DynamicTable('grid-values', {
            url: '/api/4/search/by_value',
            params: { query: query },
            colModel: [
                { display: h(texts.misc.count), name: 'count_all', width: 80, sortable: true, align: 'right' },
                { display: h(texts.osm.key), name: 'key', width: 250, sortable: true },
                { display: h(texts.osm.value), name: 'value', width: 500, sortable: true }
            ],
            sortname: 'count_all',
            sortorder: 'desc',
            processRow: row => {
                return [
                    fmt_with_ts(row.count_all),
                    link_to_key(row.key),
                    link_to_value_with_highlight(row.key, row.value, query)
                ];
            }
        });
    },
    relations: function(query) {
        return new DynamicTable('grid-relations', {
            url: '/api/4/relations/all',
            params: { query: query },
            colModel: [
                { display: h(texts.misc.count), name: 'count', width: 80, sortable: true, align: 'right' },
                { display: h(texts.osm.relation_type), name: 'rtype', width: 500, sortable: true }
            ],
            sortname: 'count',
            sortorder: 'desc',
            processRow: row => {
                return [
                    fmt_with_ts(row.count),
                    link_to_rtype_with_highlight(row.rtype, query)
                ];
            }
        });
    },
    roles: function(query) {
        return new DynamicTable('grid-roles', {
            url: '/api/4/search/by_role',
            params: { query: query },
            colModel: [
                { display: h(texts.misc.count), name: 'count_all', width: 80, sortable: true, align: 'right' },
                { display: h(texts.osm.relation_type), name: 'rtype', width: 250, sortable: true },
                { display: h(texts.osm.relation_member_roles), name: 'role', width: 500, sortable: true }
            ],
            sortname: 'count_all',
            sortorder: 'desc',
            processRow: row => {
                return [
                    fmt_with_ts(row.count_all),
                    link_to_rtype(row.rtype),
                    highlight(row.role, query)
                ];
            }
        });
    },
    fulltext: function(query) {
        return new DynamicTable('grid-fulltext', {
            url: '/api/4/search/by_keyword',
            params: { query: query },
            colModel: [
                { display: h(texts.osm.key), name: 'key', width: 300, sortable: true },
                { display: h(texts.osm.value), name: 'value', width: 500, sortable: true }
            ],
            sortname: 'key',
            sortorder: 'asc',
            processRow: row => {
                return [
                    link_to_key(row.key),
                    row.value ? link_to_value(row.key, row.value) : ''
                ];
            }
        });
    }
};

function page_init() {
    initTabs(tabsConfig, [document.getElementById('query').textContent]);
}
